<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LitWire - Feed</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<style>
body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; margin:0; }
.header-top { width:100%; background-color:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.05); position:fixed; top:0; z-index:50; }
.header-top nav { max-width: 1280px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; padding: 1rem 2rem; }
.header-top a { color:#4b5563; font-weight:500; text-decoration:none; transition:color 0.2s; }
.header-top a:hover { color:#2e598b; }
.main-container { max-width: 1100px; margin: 0 auto; padding: 1.5rem; display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-top: 5rem; }
@media (min-width: 1024px) {
    .main-container { grid-template-columns: 2fr 1fr; }
}
.post-card { background-color: #fff; border-radius: 0.75rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; }
.post-header { display: flex; align-items: center; gap: 0.75rem; }
.post-avatar { width: 48px; height: 48px; border-radius: 9999px; object-fit: cover; }
.post-actions { display: flex; justify-content: space-around; color: #6b7280; padding-top: 0.75rem; border-top: 1px solid #f3f4f6; margin-top: 1rem; }
.post-actions div { cursor: pointer; transition: color 0.2s; }
.post-actions div:hover { color: #2e598b; }
.widget-card { background-color: #fff; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; }
.poll-option { background-color: #f9fafb; border: 1px solid #e5e7eb; border-radius: 9999px; padding: 0.75rem 1.25rem; font-weight: 500; cursor: pointer; transition: all 0.2s; }
.poll-option:hover { border-color: #2e598b; background-color: #eef2ff; }
</style>
</head>
<body>

<header class="header-top">
<nav>
<div class="text-3xl font-bold text-gray-800"><a href="index.html"><span class="text-blue-900">Lit</span><span class="text-gray-900">Wire</span></a></div>
<div class="hidden md:flex items-center gap-6">
<a href="index.html">Home</a>
<a href="profile.html">Profile</a>
<a href="feed.html" class="text-blue-900 font-bold">Feed</a>
<a href="messages.html">Messages</a>
<a href="matches.html">Matches</a>
<a href="bookDash.html">Dashboard</a>
</div>
<a href="#" id="sign-out-btn" class="text-red-600 font-medium hover:text-red-800">Sign Out</a>
</nav>
</header>

<main class="main-container">
<div class="space-y-6">
    <div class="post-card p-6">
        <h2 class="text-xl font-bold mb-4 text-gray-900">Create a Post</h2>
        <form id="new-post-form" class="space-y-4">
            <textarea id="post-content" rows="3" placeholder="What's on your mind, bookworm?" class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-900 focus:ring-blue-900 p-3"></textarea>
            <button type="submit" class="w-full px-6 py-2.5 bg-blue-900 text-white font-semibold rounded-lg shadow-md hover:bg-blue-800 transition duration-300">Post</button>
        </form>
    </div>

    <div id="feed-container" class="space-y-6">
        
        <div class="post-card p-6" data-is-fake="true">
            <div class="post-header">
                <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="User Avatar" class="post-avatar">
                <div>
                    <p class="font-bold text-gray-800">Elena Rodriguez</p>
                    <p class="text-sm text-gray-500">@elenareads ¬∑ 15m</p>
                </div>
            </div>
            <div class="mt-4">
                <p class="text-gray-600 mb-3">Just finished <span class="font-semibold text-blue-900">"The Midnight Library"</span> and WOW. Such a profound and heartwarming story about choices and regrets. A must-read for anyone feeling a little lost. üìö</p>
                <div class="flex border border-gray-200 rounded-lg overflow-hidden">
                    <img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1602190253l/52578297.jpg" alt="Book Cover" class="w-28 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg">The Midnight Library</h3>
                        <p class="text-sm text-gray-600">by Matt Haig</p>
                        <div class="text-yellow-500 mt-2">
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-regular fa-star"></i>
                            <span class="text-gray-600 text-sm ml-1">4.0 / 5.0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="post-actions">
                <div><i class="fa-regular fa-heart mr-2"></i>125 Likes</div>
                <div><i class="fa-regular fa-comment mr-2"></i>32 Comments</div>
                <div><i class="fa-solid fa-retweet mr-2"></i>18 Reposts</div>
            </div>
        </div>

        <div class="post-card p-6" data-is-fake="true">
            <div class="post-header">
                <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User Avatar" class="post-avatar">
                <div>
                    <p class="font-bold text-gray-800">Brandon Chen <span class="text-xs bg-blue-100 text-blue-800 font-semibold px-2 py-1 rounded-full ml-1">Author</span></p>
                    <p class="text-sm text-gray-500">@brandonchenbooks ¬∑ 2h</p>
                </div>
            </div>
            <div class="mt-4">
                <p class="text-gray-800 mb-3 text-lg font-semibold">Cover reveal! ‚ú® So excited to share the cover for my upcoming novel, "Echoes of the Void". It's a sci-fi epic hitting shelves this fall. Pre-order link in bio!</p>
                <img src="https://marketplace.canva.com/EAFaQMYuZbo/1/0/1003w/canva-green-and-blue-illustrated-man-fantasy-book-cover-n4Pa3d9a0J8.jpg" alt="Book Cover" class="rounded-lg w-full h-auto object-cover shadow-lg">
            </div>
            <div class="post-actions">
                <div><i class="fa-regular fa-heart mr-2"></i>543 Likes</div>
                <div><i class="fa-regular fa-comment mr-2"></i>102 Comments</div>
                <div><i class="fa-solid fa-retweet mr-2"></i>97 Reposts</div>
            </div>
        </div>

        <div class="post-card p-6" data-is-fake="true">
            <div class="post-header">
                <img src="https://randomuser.me/api/portraits/women/50.jpg" alt="User Avatar" class="post-avatar">
                <div>
                    <p class="font-bold text-gray-800">Book Club Betties</p>
                    <p class="text-sm text-gray-500">@BCBetties ¬∑ 8h</p>
                </div>
            </div>
            <div class="mt-4">
                <p class="text-gray-800 mb-4">Time to pick our book for next month! What genre are we all in the mood for?</p>
                <div class="space-y-3">
                    <div class="poll-option">ü§î Thriller / Mystery</div>
                    <div class="poll-option">üíñ Contemporary Romance</div>
                    <div class="poll-option">üöÄ Science Fiction</div>
                    <div class="poll-option">üè∞ High Fantasy</div>
                </div>
                <p class="text-sm text-gray-500 mt-3">1,284 votes ¬∑ 3 days left</p>
            </div>
            <div class="post-actions">
                <div><i class="fa-regular fa-heart mr-2"></i>98 Likes</div>
                <div><i class="fa-regular fa-comment mr-2"></i>45 Comments</div>
                <div><i class="fa-solid fa-retweet mr-2"></i>22 Reposts</div>
            </div>
        </div>

        <div class="post-card p-6" data-is-fake="true">
            <div class="post-header">
                <img src="https://randomuser.me/api/portraits/men/54.jpg" alt="User Avatar" class="post-avatar">
                <div>
                    <p class="font-bold text-gray-800">Reading Rex</p>
                    <p class="text-sm text-gray-500">@readingrex ¬∑ 1d</p>
                </div>
            </div>
            <div class="mt-4">
                <p class="text-gray-700 text-base leading-relaxed">Does anyone else have a "comfort read"? That one book you can always go back to when you need a pick-me-up. Mine is definitely 'The Hobbit'.</p>
            </div>
            <div class="post-actions">
                <div><i class="fa-regular fa-heart mr-2"></i>210 Likes</div>
                <div><i class="fa-regular fa-comment mr-2"></i>88 Comments</div>
                <div><i class="fa-solid fa-retweet mr-2"></i>12 Reposts</div>
            </div>
        </div>

    </div>
</div>

<aside class="hidden lg:block space-y-6">
    <div class="widget-card">
        <h3 class="font-bold text-lg mb-4">üî• Trending Books</h3>
        <ul class="space-y-4">
            <li class="flex items-center gap-4">
                <img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1660242220l/61431922._SY475_.jpg" alt="Book" class="w-12 h-16 object-cover rounded">
                <div>
                    <p class="font-semibold">Fourth Wing</p>
                    <p class="text-sm text-gray-500">Rebecca Yarros</p>
                </div>
            </li>
            <li class="flex items-center gap-4">
                <img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1675108892l/60318873.jpg" alt="Book" class="w-12 h-16 object-cover rounded">
                <div>
                    <p class="font-semibold">Iron Flame</p>
                    <p class="text-sm text-gray-500">Rebecca Yarros</p>
                </div>
            </li>
             <li class="flex items-center gap-4">
                <img src="https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1589255531l/53452934.jpg" alt="Book" class="w-12 h-16 object-cover rounded">
                <div>
                    <p class="font-semibold">The Invisible Life of Addie LaRue</p>
                    <p class="text-sm text-gray-500">V.E. Schwab</p>
                </div>
            </li>
        </ul>
    </div>
    
    <div class="widget-card">
        <h3 class="font-bold text-lg mb-4">üë• Who to Follow</h3>
        <ul class="space-y-4">
            <li class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="https://randomuser.me/api/portraits/women/68.jpg" alt="User" class="w-10 h-10 object-cover rounded-full">
                    <div>
                        <p class="font-semibold">Sarah J. Reads</p>
                        <p class="text-sm text-gray-500">@sjm_fangirl</p>
                    </div>
                </div>
                <button class="bg-blue-900 text-white font-semibold px-4 py-1.5 rounded-full text-sm hover:bg-blue-800">Follow</button>
            </li>
            <li class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="https://randomuser.me/api/portraits/men/75.jpg" alt="User" class="w-10 h-10 object-cover rounded-full">
                    <div>
                        <p class="font-semibold">Ken Reads Sci-Fi</p>
                        <p class="text-sm text-gray-500">@ken_scifi</p>
                    </div>
                </div>
                <button class="bg-gray-200 text-gray-800 font-semibold px-4 py-1.5 rounded-full text-sm hover:bg-gray-300">Follow</button>
            </li>
        </ul>
    </div>
</aside>
</main>

<footer class="bg-gray-800 text-white py-6 mt-12 w-full">
<div class="max-w-7xl mx-auto text-center text-sm px-4">&copy; 2025 LitWire. All rights reserved.</div>
</footer>

<div id="loading-overlay" class="loading-overlay hidden"> ... </div>
<div id="error-overlay" class="hidden"> ... </div>

<script type="module">
// Firebase init
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc, doc, getDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBxYO1_dzEP2eLAADSG1hsjKBcDjeFCpmk",
  authDomain: "litwire-97956.firebaseapp.com",
  projectId: "litwire-97956",
  storageBucket: "litwire-97956.appspot.com",
  messagingSenderId: "263009111921",
  appId: "1:263009111921:web:713622b1cfa59ddb9130d0",
  measurementId: "G-ZWVFHF5YQX"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const signOutBtn = document.getElementById('sign-out-btn');
const newPostForm = document.getElementById('new-post-form');
const postContentInput = document.getElementById('post-content');
const feedContainer = document.getElementById('feed-container');
let userId = null;
let userProfile = null;

// Function to format time difference
function timeAgo(date) {
    const seconds = Math.floor((new Date() - date) / 1000);
    let interval = seconds / 31536000;
    if (interval > 1) return Math.floor(interval) + "y";
    interval = seconds / 2592000;
    if (interval > 1) return Math.floor(interval) + "mo";
    interval = seconds / 86400;
    if (interval > 1) return Math.floor(interval) + "d";
    interval = seconds / 3600;
    if (interval > 1) return Math.floor(interval) + "h";
    interval = seconds / 60;
    if (interval > 1) return Math.floor(interval) + "m";
    return Math.floor(seconds) + "s";
}


onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = 'index.html';
    return;
  }
  userId = user.uid;
  try {
    const userDoc = await getDoc(doc(db, `users/${userId}`));
    userProfile = userDoc.exists() ? userDoc.data() : { name: 'Anonymous User', handle: '@anonymous' };
    setupFeedListener();
  } catch (err) { console.error(err); }
});

signOutBtn.addEventListener('click', async () => {
  try {
    await signOut(auth);
    window.location.href = 'index.html';
  } catch (err) { console.error(err); }
});

function setupFeedListener() {
  const feedCollectionRef = collection(db, 'feed');
  const q = query(feedCollectionRef, orderBy('createdAt', 'desc'));

  onSnapshot(q, (snapshot) => {
    // Remove existing non-fake posts
    Array.from(feedContainer.children)
      .filter(el => !el.dataset.isFake)
      .forEach(el => el.remove());

    snapshot.forEach(docSnap => {
      const post = docSnap.data();
      const postElement = document.createElement('div');
      postElement.className = 'post-card p-6'; // Use the new post card style
      
      const postDate = post.createdAt?.toDate();
      const displayTime = postDate ? timeAgo(postDate) : '';

      postElement.innerHTML = `
        <div class="post-header">
            <img src="${post.authorAvatar || 'https://i.pravatar.cc/48'}" alt="User Avatar" class="post-avatar">
            <div>
                <p class="font-bold text-gray-800">${post.authorName || 'User'}</p>
                <p class="text-sm text-gray-500">${post.authorHandle || '@user'} ¬∑ ${displayTime}</p>
            </div>
        </div>
        <div class="mt-4">
            <p class="text-gray-700 text-base leading-relaxed">${post.content}</p>
        </div>
        <div class="post-actions">
            <div><i class="fa-regular fa-heart mr-2"></i>0 Likes</div>
            <div><i class="fa-regular fa-comment mr-2"></i>0 Comments</div>
            <div><i class="fa-solid fa-retweet mr-2"></i>0 Reposts</div>
        </div>
      `;
      feedContainer.prepend(postElement); // Prepend to show new posts on top
    });
  }, (err) => console.error(err));
}

newPostForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const content = postContentInput.value.trim();
  if (!content || !userId) return;

  try {
    await addDoc(collection(db, 'feed'), {
      content,
      authorId: userId,
      authorName: userProfile?.name || 'Anonymous User',
      authorHandle: userProfile?.handle || '@user', // Assuming handle is stored in profile
      authorAvatar: userProfile?.avatar || 'https://i.pravatar.cc/48', // Assuming avatar is stored
      createdAt: serverTimestamp()
    });
    postContentInput.value = '';
  } catch (err) { console.error(err); }
});
</script>
</body>
</html>
