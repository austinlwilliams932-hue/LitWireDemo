async function signInWithCloudRunToken(uid) {
    try {
        const response = await fetch("https://jwt-737284668725.us-east4.run.app/getCustomToken", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ uid })
        });

        // üîç Log raw response
        console.log("Response status:", response.status);
        console.log("Response headers:");
        for (let [key, value] of response.headers.entries()) {
            console.log(`  ${key}: ${value}`);
        }

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log("Response JSON:", data);

        if (!data.token) {
            throw new Error("No token returned from backend");
        }

        // Sign in with the custom token
        return signInWithCustomToken(auth, data.token);

    } catch (err) {
        console.error("Failed to get custom token:", err);
        throw err;
    }
}
