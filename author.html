<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LitWire - Author Survey</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-2xl">
    <h1 class="text-2xl font-bold mb-6 text-center">Author Survey</h1>

    <form id="authorForm" class="space-y-4">
      <!-- Book Title -->
      <div>
        <label class="block font-medium">Book Title</label>
        <input type="text" name="bookTitle" required class="w-full border p-2 rounded">
      </div>

      <!-- Book Description -->
      <div>
        <label class="block font-medium">Book Description</label>
        <textarea name="bookDescription" required class="w-full border p-2 rounded"></textarea>
      </div>

      <!-- Subgenre -->
      <div>
        <label class="block font-medium">Genre / Subgenre</label>
        <input type="text" name="subgenre" required class="w-full border p-2 rounded">
      </div>

      <!-- Campaign Start -->
      <div>
        <label class="block font-medium">Campaign Start Date</label>
        <input type="date" name="startDate" required class="w-full border p-2 rounded">
      </div>

      <!-- Campaign End -->
      <div>
        <label class="block font-medium">Campaign End Date</label>
        <input type="date" name="endDate" required class="w-full border p-2 rounded">
      </div>

      <!-- Budget -->
      <div>
        <label class="block font-medium">Budget</label>
        <input type="number" name="budget" required class="w-full border p-2 rounded">
      </div>

      <!-- Audience Comfort -->
      <div>
        <label class="block font-medium">Promotion Comfort Level</label>
        <select name="promotionComfort" required class="w-full border p-2 rounded">
          <option value="">Select comfort level</option>
          <option value="beginner">Beginner</option>
          <option value="intermediate">Intermediate</option>
          <option value="expert">Expert</option>
        </select>
      </div>

      <!-- Submit -->
      <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">
        Generate Marketing Plan
      </button>
    </form>
  </div>

  <script type="module">
    async function generateMarketingPlan(formData) {
      try {
        const response = await fetch("https://bookie-737284668725.us-central1.run.app/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            book_title: formData.bookTitle,
            book_description: formData.bookDescription,
            book_genre: formData.subgenre,
            campaign_length: `${formData.startDate} to ${formData.endDate}`,
            budget: formData.budget,
            desired_audience_type: formData.promotionComfort
          })
        });

        if (!response.ok) {
          throw new Error("Failed to generate plan");
        }

        return await response.json();
      } catch (err) {
        console.error("Error generating marketing plan:", err);
        throw err;
      }
    }

    document.getElementById("authorForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = Object.fromEntries(new FormData(e.target));

      try {
        const result = await generateMarketingPlan(formData);
        console.log("Marketing Plan:", result);

        // ✅ Save plan to localStorage so the next page can load it
        localStorage.setItem("marketingPlan", JSON.stringify(result));

        // ✅ Redirect to results page
        window.location.href = "marketingPlan.html";
      } catch (err) {
        alert("Error generating marketing plan. Please try again.");
      }
    });
  </script>
</body>
</html>
