<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LitWire - Book Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
.header-top { width:100%; background-color:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.05); position:fixed; top:0; z-index:50; }
.header-top nav { max-width: 1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; padding:1rem; }
.header-top a { color:#4b5563; font-weight:500; display:flex; align-items:center; gap:0.5rem; transition:color 0.2s; }
.header-top a:hover { color:#2e598b; }
.sidebar { background-color: #fff; width: 250px; min-height: 100vh; border-right:1px solid #e5e7eb; padding-top:5rem; position:fixed; top:0; left:0; }
.sidebar .book-item { padding: 0.75rem 1rem; cursor:pointer; border-radius:0.5rem; margin:0.25rem 0; transition: background 0.2s; }
.sidebar .book-item:hover { background-color:#e0f2fe; }
.main { margin-left:250px; padding:6rem 2rem 2rem 2rem; }
.book-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:2rem; }
.book-info { display:flex; align-items:center; gap:1rem; }
.book-cover { width:80px; height:120px; object-fit:cover; border-radius:0.5rem; }
.status-badge { background-color:#22c55e; color:#fff; padding:0.25rem 0.5rem; border-radius:0.25rem; font-size:0.75rem; font-weight:600; }
.tabs { display:flex; gap:1rem; border-bottom:1px solid #e5e7eb; margin-bottom:1rem; }
.tabs button { padding:0.5rem 1rem; font-weight:500; border-bottom:2px solid transparent; transition: all 0.2s; }
.tabs button.active { border-bottom-color:#2e598b; color:#2e598b; }
.tab-panel { margin-top:1rem; }
.tab-panel.hidden { display:none; }
.metric-card { background-color:#fff; padding:1rem 2rem; border-radius:0.5rem; box-shadow:0 2px 6px rgba(0,0,0,0.05); flex:1; text-align:center; }
.metrics { display:flex; gap:2rem; flex-wrap:wrap; margin-bottom:2rem; }
.influencer-card { background-color:#fff; padding:1rem; border-radius:0.5rem; box-shadow:0 2px 6px rgba(0,0,0,0.05); }
.filter-group { margin-bottom:1rem; display:flex; gap:1rem; flex-wrap:wrap; }
.messages { display:flex; gap:1rem; height:400px; }
.messages .thread-list { width:200px; background-color:#fff; padding:1rem; overflow-y:auto; border-radius:0.5rem; }
.messages .conversation { flex:1; background-color:#fff; padding:1rem; border-radius:0.5rem; overflow-y:auto; }
.chart-placeholder { background-color:#fff; height:200px; border-radius:0.5rem; display:flex; justify-content:center; align-items:center; color:#9ca3af; margin-bottom:1rem; }
.loading-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.7); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:50; color:#fff; text-align:center; }
.spinner { border:4px solid rgba(255,255,255,0.3); border-top:4px solid #fff; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
#error-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(255,0,0,0.85); color:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:60; text-align:center; padding:1rem; font-family:monospace; overflow:auto; }
#error-overlay.hidden { display:none; }
</style>
</head>
<body>

<!-- Header -->
<header class="header-top">
<nav class="container flex justify-between items-center px-4 md:px-8">
<div class="text-3xl font-bold text-gray-800"><a href="loggedInLanding.html"><span class="text-blue-900">Lit</span><span class="text-gray-900">Wire</span></a></div>
<div class="flex gap-6">
<a href="loggedInLanding.html"><i class="fas fa-home"></i> Home</a>
<a href="profile.html"><i class="fas fa-user"></i> Profile</a>
<a href="feed.html"><i class="fas fa-rss"></i> Feed</a>
<a href="messages.html"><i class="fas fa-envelope"></i> Messages</a>
<a href="matches.html"><i class="fas fa-handshake"></i> Matches</a>
<a href="bookDash.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
</div>
</nav>
</header>

<!-- Sidebar -->
<div class="sidebar" id="bookshelf">
<h2 class="text-xl font-bold mb-4 px-4">Bookshelf</h2>
</div>

<!-- Main content -->
<div class="main">
<div class="book-header">
<div class="book-info">
<img src="" alt="Book Cover" class="book-cover" id="book-cover">
<div>
<h1 class="text-2xl font-bold" id="book-title">Book Title</h1>
<p class="text-gray-500" id="campaign-dates">Campaign: --</p>
</div>
</div>
<span class="status-badge" id="status-badge">Live</span>
</div>

<div class="tabs">
<button class="tab-btn active" data-tab="overview">Overview</button>
<button class="tab-btn" data-tab="influencers">Influencers</button>
<button class="tab-btn" data-tab="messages">Messages</button>
<button class="tab-btn" data-tab="analytics">Analytics</button>
<button class="tab-btn" data-tab="campaign-plan">Campaign Plan</button>
<button class="tab-btn" data-tab="matches">Matches</button>
</div>

<div class="tab-content">
<!-- Overview -->
<div class="tab-panel" id="overview">
<div class="metrics">
<div class="metric-card"><div class="text-2xl font-bold" id="metric-matches">0</div><div>Influencer Matches</div></div>
<div class="metric-card"><div class="text-2xl font-bold" id="metric-reading">0</div><div>Reading / Reviewing</div></div>
<div class="metric-card"><div class="text-2xl font-bold" id="metric-posts">0</div><div>Upcoming Posts</div></div>
</div>
</div>

<!-- Influencers -->
<div class="tab-panel hidden" id="influencers">
<div class="filter-group">
<select class="form-select" id="filter-platform"><option>All Platforms</option></select>
<select class="form-select" id="filter-tier"><option>All Engagement Tiers</option></select>
<select class="form-select" id="filter-region"><option>All Regions</option></select>
</div>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="influencer-grid"></div>
</div>

<!-- Messages -->
<div class="tab-panel hidden" id="messages">
<div class="messages">
<div class="thread-list" id="thread-list"></div>
<div class="conversation" id="conversation"></div>
</div>
</div>

<!-- Analytics -->
<div class="tab-panel hidden" id="analytics">
<div class="chart-placeholder">Engagement Growth Chart</div>
<div class="chart-placeholder">Influencer Reach Chart</div>
<div class="chart-placeholder">Post Performance Chart</div>
</div>

<!-- Campaign Plan -->
<div class="tab-panel hidden" id="campaign-plan">
<div class="bg-white p-4 rounded shadow mb-4" id="campaign-plan-content">Auto-generated outreach plan will appear here.</div>
</div>

<!-- Matches -->
<div class="tab-panel hidden" id="matches">
<div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="matches-grid"></div>
</div>
</div>
</div>

<!-- Loading & Error -->
<div id="loading-overlay" class="loading-overlay hidden"><div class="spinner mb-4"></div><div class="text-xl font-medium">Loading...</div></div>
<div id="error-overlay" class="hidden"><h2 class="text-2xl font-bold mb-4">Error</h2><pre id="debug-output" class="whitespace-pre-wrap"></pre><button onclick="document.getElementById('error-overlay').classList.add('hidden'); document.getElementById('loading-overlay').classList.add('hidden');" class="px-4 py-2 bg-blue-800 text-white rounded mt-2">Close</button></div>

<script type="module">
// Firebase init
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, doc, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = { apiKey:"AIzaSyBxYO1_dzEP2eLAADSG1hsjKBcDjeFCpmk", authDomain:"litwire-97956.firebaseapp.com", projectId:"litwire-97956", storageBucket:"litwire-97956.appspot.com", messagingSenderId:"263009111921", appId:"1:263009111921:web:713622b1cfa59ddb9130d0", measurementId:"G-ZWVFHF5YQX" };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loadingOverlay = document.getElementById('loading-overlay');
const errorOverlay = document.getElementById('error-overlay');
const debugOutput = document.getElementById('debug-output');

const bookCoverEl = document.getElementById('book-cover');
const bookTitleEl = document.getElementById('book-title');
const campaignDatesEl = document.getElementById('campaign-dates');
const statusBadgeEl = document.getElementById('status-badge');
const metricMatches = document.getElementById('metric-matches');
const metricReading = document.getElementById('metric-reading');
const metricPosts = document.getElementById('metric-posts');

const influencerGrid = document.getElementById('influencer-grid');
const threadList = document.getElementById('thread-list');
const conversation = document.getElementById('conversation');
const campaignPlanContent = document.getElementById('campaign-plan-content');
const matchesGrid = document.getElementById('matches-grid');
const bookshelfEl = document.getElementById('bookshelf');

// Tabs
const tabs=document.querySelectorAll('.tab-btn');
const panels=document.querySelectorAll('.tab-panel');
tabs.forEach(tab=>tab.addEventListener('click',()=>{
  tabs.forEach(t=>t.classList.remove('active'));
  tab.classList.add('active');
  panels.forEach(p=>p.classList.add('hidden'));
  document.getElementById(tab.dataset.tab).classList.remove('hidden');
}));

onAuthStateChanged(auth, async (user)=>{
  if(!user){ window.location.href='index.html'; return;}
  loadingOverlay.classList.remove('hidden');
  try{
    // Load bookshelf
    const booksSnap = await getDocs(collection(db, `users/${user.uid}/books`));
    booksSnap.forEach(bookDoc=>{
      const data = bookDoc.data();
      const item = document.createElement('div');
      item.className = 'book-item';
      item.textContent = data.title || 'Untitled Book';
      item.addEventListener('click', ()=>loadBook(user.uid, bookDoc.id));
      bookshelfEl.appendChild(item);
    });
    const firstBook = booksSnap.docs[0];
    if(firstBook) loadBook(user.uid, firstBook.id);
  }catch(err){ debugOutput.textContent=JSON.stringify(err,null,2); errorOverlay.classList.remove('hidden'); }
  finally{loadingOverlay.classList.add('hidden');}
});

async function loadBook(userId, bookId){
  loadingOverlay.classList.remove('hidden');
  try{
    const bookRef = doc(db, `users/${userId}/books/${bookId}`);
    const bookSnap = await getDoc(bookRef);
    if(!bookSnap.exists()) throw 'Book not found';
    const book = bookSnap.data();

    bookCoverEl.src = book.coverUrl || 'book-cover-placeholder.jpg';
    bookTitleEl.textContent = book.title || 'Untitled';
    campaignDatesEl.textContent = `Campaign: ${book.startDate || '--'} – ${book.endDate || '--'}`;
    statusBadgeEl.textContent = book.status || 'Live';

    metricMatches.textContent = book.metrics?.matches || 0;
    metricReading.textContent = book.metrics?.reading || 0;
    metricPosts.textContent = book.metrics?.upcomingPosts || 0;

    influencerGrid.innerHTML='';
    (book.influencers||[]).forEach(inf=>{
      const card=document.createElement('div'); card.className='influencer-card';
      card.innerHTML=`<img src="${inf.pic||'profile-pic.jpg'}" class="w-16 h-16 rounded-full mb-2"><div class="font-semibold">${inf.name}</div><div class="text-sm text-gray-500">${inf.platforms?.join(', ')||''}</div><div class="text-sm text-gray-400">Reach: ${inf.reach||0}</div><div class="flex gap-1 mt-2 flex-wrap">${(inf.tags||[]).map(tag=>`<span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs">${tag}</span>`).join('')}</div>`; influencerGrid.appendChild(card);
    });

    threadList.innerHTML=''; conversation.innerHTML='';
    (book.messages||[]).forEach(thread=>{
      const div=document.createElement('div'); div.className='p-2 hover:bg-gray-100 cursor-pointer rounded'; div.textContent=thread.name;
      threadList.appendChild(div);
    });

    campaignPlanContent.textContent=book.campaignPlan||'Auto-generated outreach plan will appear here.';
    matchesGrid.innerHTML='';
    (book.matches||[]).forEach(match=>{
      const div=document.createElement('div'); div.className='bg-white p-4 rounded shadow';
      div.innerHTML=`<div class="flex justify-between items-center mb-2"><span>${match.name}</span><span class="text-sm text-gray-500">Fit: ${match.fit}%</span></div><div>Status: ${match.status}</div>`;
      matchesGrid.appendChild(div);
    });
  }catch(err){ debugOutput.textContent=JSON.stringify(err,null,2); errorOverlay.classList.remove('hidden'); }
  finally{loadingOverlay.classList.add('hidden');}
}
</script>
</body>
</html>
