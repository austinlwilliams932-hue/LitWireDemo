<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LitWire - Your Marketing Plan</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
.container { max-width: 800px; margin: 0 auto; }
.content-card { background-color: #fff; padding: 2rem; border-radius: 1rem; margin-bottom: 1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.1); white-space: pre-wrap; }
.spinner { border: 4px solid rgba(0,0,0,0.1); border-top-color: #1e40af; border-radius: 50%; width: 3rem; height: 3rem; animation: spin 1s linear infinite; margin: auto; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.hidden { display: none; }
</style>
</head>
<body class="flex flex-col items-center min-h-screen">

<header class="w-full bg-white shadow-md py-4">
<div class="container text-3xl font-bold text-gray-800">
<span class="text-blue-900">Lit</span><span class="text-gray-900">Wire</span>
</div>
</header>

<main class="flex-grow container mt-8 px-4">
<h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">Your Marketing Plan</h1>

<div id="loading" class="text-center">
  <div class="spinner"></div>
  <p class="mt-2 text-gray-600">Generating your personalized plan...</p>
</div>

<div id="plan-container" class="hidden"></div>
<div id="error-message" class="text-red-500 hidden text-center"></div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBxYO1_dzEP2eLAADSG1hsjKBcDjeFCpmk",
  authDomain: "litwire-97956.firebaseapp.com",
  projectId: "litwire-97956",
  storageBucket: "litwire-97956.appspot.com",
  messagingSenderId: "263009111921",
  appId: "1:263009111921:web:713622b1cfa59ddb9130d0",
  measurementId: "G-ZWVFHF5YQX"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const loadingEl = document.getElementById("loading");
const planContainer = document.getElementById("plan-container");
const errorEl = document.getElementById("error-message");

async function loadMarketingPlan() {
  try {
    // Sign in anonymously
    const userCredential = await signInAnonymously(auth);
    const user = userCredential.user;

    // Fetch the saved plan from Firestore
    const docRef = doc(db, `users/${user.uid}/profiles/author`);
    const docSnap = await getDoc(docRef);

    if (!docSnap.exists()) throw new Error("No marketing plan found for this user.");

    const data = docSnap.data();
    const plan = data.marketingPlan || [];
    if (!plan.length) throw new Error("Marketing plan is empty.");

    // Hide spinner
    loadingEl.classList.add("hidden");
    planContainer.classList.remove("hidden");

    // Render the plan
    planContainer.innerHTML = plan.map((item, i) => `
      <div class="content-card">
        <h2 class="text-xl font-bold mb-2">Opportunity ${i+1}</h2>
        <p><strong>Details:</strong> ${item.opportunity_details ? JSON.stringify(item.opportunity_details, null, 2) : "N/A"}</p>
        <p><strong>Rationale:</strong> ${item.rationale || "N/A"}</p>
        <p><strong>Draft Message:</strong> ${item.draft_message || "N/A"}</p>
        <p><strong>Contact:</strong> ${item.contact_information || "N/A"}</p>
      </div>
    `).join("");

  } catch (err) {
    console.error(err);
    loadingEl.classList.add("hidden");
    errorEl.textContent = err.message;
    errorEl.classList.remove("hidden");
  }
}

loadMarketingPlan();
</script>
</body>
</html>
